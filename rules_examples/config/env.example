# rules_examples/config/env.example
# 说明：
# - 建议把真实密钥写到本地的 config/env（该文件默认被 .gitignore 忽略）
# - 本文件仅作为“可提交的模板”
#
# 语法：
# - 支持 KEY=VALUE 或 export KEY=VALUE
# - 支持注释行（# ...）与空行

# ----------------------------
# 外部 AI/LLM（OpenAI 兼容 API）
# ----------------------------
OPENAI_API_KEY=
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# ----------------------------
# SFEmu AI 干预框架（base/ai.lua）
# ----------------------------
# 1=开启（默认建议开启：仅在 exit/死循环触发时生效）
SFEMU_AI_ENABLE=1

# 自动继续（仅当本轮应用了 fix 规则时才会自动继续）
SFEMU_AI_AUTO_CONTINUE=1

# 是否自动应用 rules_patch（默认 1）
SFEMU_AI_APPLY_RULES=1

# 是否覆盖已有 syscall/<name>.lua（默认 0；开启会先备份）
SFEMU_AI_OVERWRITE_RULES=0

# 验证窗口：应用修复规则后，继续运行 N 个 syscall 即认为“稳定”，并导出 stable_rules
SFEMU_AI_VERIFY_SYSCALLS=2048

# 导出 stable_rules 后自动关闭 AI（默认 1）
SFEMU_AI_DISABLE_AFTER_STABLE=1

# 在“关键 syscall 返回错误”时触发 AI 干预并在该 syscall 点尝试重试（避免走到 exit 才介入）。
# - 1=开启（默认）
# - 0=关闭（仅在 exit/死循环触发）
SFEMU_AI_REPAIR_ON_ERROR=1

# 触发范围：逗号分隔的 syscall 名称（默认：open,openat,access,ioctl）
SFEMU_AI_REPAIR_SYSCALLS=open,openat,access,ioctl

# 触发错误码：逗号分隔 errno（默认：1,2,13,19,22,25）
SFEMU_AI_REPAIR_ERRNOS=1,2,13,19,22,25

# exit/exit_group 场景：当 AI 已应用“修复型规则”且选择自动继续时，
# 是否触发 QEMU 自身 re-exec 重新运行目标（用于“重新加载镜像/重试验证”）。
# - 1=开启（默认开启）
# - 0=关闭（保持原行为：exit 会直接结束进程）
SFEMU_AI_REEXEC_ON_EXIT_FIX=1

# re-exec 最大次数限制（防止修复无效导致无限重启），默认 3；设置为 0 表示禁用 re-exec。
SFEMU_REEXEC_MAX=3

# 外部工具命令（可选）：若设置，将执行：
#   $SFEMU_AI_CMD <snapshot.json> <rules_patch_dir> <env_path>
SFEMU_AI_CMD=

# 内置“类 MCP”：未设置 SFEMU_AI_CMD 时，自动调用 OpenAI 兼容 API 生成规则
SFEMU_AI_MCP_ENABLE=0
# SFEMU_AI_MCP_PY=python3
# SFEMU_AI_MCP_SCRIPT=./rules_examples/plugins/ai/ai_mcp_openai.py

# MCP prompt：是否附带“调用栈对应的伪C代码”（来自 cache/ai_runs/.../pseudocode/*.txt）。
# 默认开启，但会严格截断避免 prompt 过大；可按需调小/关闭以减少 tokens 与 API 成本。
SFEMU_AI_MCP_INCLUDE_PSEUDOCODE=1
SFEMU_AI_MCP_PSEUDOCODE_FRAMES=4
SFEMU_AI_MCP_PSEUDOCODE_MAX_BYTES=32768
SFEMU_AI_MCP_PSEUDOCODE_FILE_BYTES=8192

# ----------------------------
# 一键无人值守（推荐在批量跑固件时使用）
# ----------------------------
# auto_ai=1：遇到异常退出/死循环/长时间无 syscall 时：
# - 不再提示 “输入 YES 继续运行”
# - 自动触发 AI 干预（即使 SFEMU_AI_ENABLE=0 也会强制启用）
auto_ai=0
